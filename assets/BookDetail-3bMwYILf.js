import{m as E,r as o,j as e,g as R}from"./index-Dlb-Vogc.js";import{s as y,u as w,a as h}from"./toastUpdating-eMtTc5eb.js";const A=()=>{const{id:r}=E(),[s,g]=o.useState(null),[l,x]=o.useState(0),[D,m]=o.useState(0),[u,p]=o.useState(""),[j,v]=o.useState(!1),[S,b]=o.useState(""),[f,T]=o.useState(0),d=250,C=t=>{const[i,n,a]=t.split("-");if(!a)return"Ngày không hợp lệ";const[c,B]=a.split(" "),L=`${c}-${n}-${i}T${B}`,k=new Date(L);return`${k.toLocaleDateString()} ${k.toLocaleTimeString()}`},G=async()=>{if(l===0){b("Vui lòng chọn số sao!");return}v(!0),b("");const t=y("Đang gửi đánh giá...");try{const i=localStorage.getItem("token"),n=await fetch("http://localhost:8080/DanhGia/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({idSach:Number(r),diemDanhGia:l,noiDung:u})});if(n.ok){p(""),x(0),r&&N(r,g),w(t,"Gửi đánh giá thành công!");return}else{const a=await n.text();h(t,a)}}catch{h(t,"Không kết nối được đến máy chủ")}v(!1)},$=async()=>{await R("Chắc chắn gửi bình luận này?(sau khi gửi sẽ không thể xoá)")&&await G()},N=async(t,i)=>{let n;setTimeout(()=>{n=y("Đang tải chi tiết sách...")},0);try{const a=await fetch(`http://localhost:8080/sach/getSach/${t}`);if(a.ok){const c=await a.json();i(c),w(n,"Tải chi tiết sách thành công!")}else{const c=await a.text();h(n,c)}}catch(a){console.error("Lỗi lấy chi tiết sách:",a),h(n,"Không kết nối được đến máy chủ")}};return o.useEffect(()=>{r&&N(r,g)},[r]),s?e.jsxs("div",{className:"book-detail-container",children:[e.jsxs("div",{className:"book-detail-card",children:[e.jsx("div",{className:"book-detail-left",children:e.jsx("img",{src:`data:image/jpeg;base64,${s.anhBia}`,alt:s.tenSach})}),e.jsxs("div",{className:"book-detail-right",children:[e.jsx("h2",{children:s.tenSach}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tác giả:"})," ",s.tacGia]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nhà xuất bản:"})," ",s.nhaXuatBan]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Năm xuất bản:"})," ",s.namXuatBan]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tiền mượn:"})," ",(s.tienMuon*1e3).toLocaleString("vi-VN"),"đ/ngày"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Sách sẵn sàng:"})," ",s.soSachSanSangChoMuon]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Thể loại:"})," ",s.theLoais.join(", ")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Điểm đánh giá:"})," ⭐ ",s.diemDanhGia.toFixed(1)," (",s.soLuotDanhGia," lượt)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Giới thiệu:"})," ",s.tomTat]})]})]}),e.jsxs("div",{className:"user-review-form",children:[e.jsx("h3",{children:"Viết đánh giá của bạn"}),e.jsx("div",{className:"star-rating",children:[1,2,3,4,5].map(t=>e.jsx("span",{className:`star ${t<=(D||l)?"filled":""}`,onClick:()=>x(t),onMouseEnter:()=>m(t),onMouseLeave:()=>m(0),children:"★"},t))}),e.jsxs("div",{style:{position:"relative",width:"100%"},children:[" ",e.jsx("textarea",{placeholder:"Nhập nội dung đánh giá...(tối đa 250 kí tự)",value:u,onChange:t=>{p(t.target.value),T(t.target.value.length)},maxLength:d,style:{width:"100%",height:"130px",padding:"10px",paddingBottom:"30px",resize:"none",fontSize:"1rem",borderRadius:"6px",border:"1px solid #ccc",boxSizing:"border-box"}}),e.jsxs("div",{style:{position:"absolute",right:"10px",bottom:"10px",fontSize:"0.8rem",color:f>=d?"red":"#666",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"0 4px",borderRadius:"3px",pointerEvents:"none"},children:[f,"/",d]})]}),e.jsx("button",{onClick:$,disabled:j,children:j?"Đang gửi...":"Gửi"}),S&&e.jsx("div",{className:"error-bookmgmt",children:S})]}),e.jsxs("div",{className:"book-review-section",children:[e.jsx("h3",{children:"Đánh giá từ độc giả"}),s.danhGias.length===0?e.jsx("p",{children:"Chưa có đánh giá nào."}):s.danhGias.map((t,i)=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("img",{src:t.anhDaiDien?`data:image/jpeg;base64,${t.anhDaiDien}`:"/quanlythuvien-deploy/images/def-avt.png",alt:"avatar",className:"review-avatar"}),e.jsxs("div",{className:"review-user-info",children:[e.jsx("p",{className:"review-name",children:t.hoten}),e.jsx("p",{className:"review-date",children:C(t.ngayDanhGia)})]})]}),e.jsxs("p",{className:"review-rating",children:["⭐ ",t.diemDanhGia,"/5"]}),e.jsx("p",{className:"review-content",children:t.noiDung})]},i))]})]}):e.jsx("div",{className:"loading",children:"Đang tải chi tiết sách..."})};export{A as default};
