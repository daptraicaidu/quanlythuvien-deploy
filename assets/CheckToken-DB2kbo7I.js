import{r as i}from"./index-CLX61_4c.js";class c extends Error{}c.prototype.name="InvalidTokenError";function l(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,o)=>{let r=o.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function d(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return l(e)}catch{return atob(e)}}function f(t,e){if(typeof t!="string")throw new c("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,r=t.split(".")[o];if(typeof r!="string")throw new c(`Invalid token specified: missing part #${o+1}`);let a;try{a=d(r)}catch(n){throw new c(`Invalid token specified: invalid base64 for part #${o+1} (${n.message})`)}try{return JSON.parse(a)}catch(n){throw new c(`Invalid token specified: invalid json for part #${o+1} (${n.message})`)}}const w=()=>{const[t,e]=i.useState(null),[o,r]=i.useState(!0);return i.useEffect(()=>{const a=localStorage.getItem("token");if(a)try{const n=f(a),s=Date.now()/1e3;n.exp>s?e(n.vaiTro):(localStorage.removeItem("token"),localStorage.removeItem("vaiTro"),window.location.pathname!=="/"&&(window.location.href="/"))}catch(n){console.error("Token không hợp lệ:",n),localStorage.removeItem("token"),localStorage.removeItem("vaiTro"),window.location.pathname!=="/"&&(window.location.href="/")}else window.location.pathname!=="/"&&(window.location.href="/");r(!1)},[]),{role:t,loading:o}};export{w as u};
