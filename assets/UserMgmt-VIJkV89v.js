import{r as s,j as e,g as q}from"./index-CRlUMUKW.js";import{u as J}from"./CheckToken-DQMO184W.js";import{s as g,a as r,u}from"./toastUpdating-DHhL3DLh.js";const X=()=>{J();const[m,U]=s.useState([]),[k,P]=s.useState(0),[p,$]=s.useState(""),[x,A]=s.useState(""),[j,R]=s.useState(""),[l,v]=s.useState(1),[E,H]=s.useState(1),[S,N]=s.useState(1),[b,T]=s.useState(""),[D,y]=s.useState(null),[i,h]=s.useState(null),[f,w]=s.useState(""),C=s.useRef(null),L=t=>{h(t),w(t.hoTen)};s.useEffect(()=>{if(!i)return;const t=a=>{C.current&&!C.current.contains(a.target)&&h(null)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[i]),s.useEffect(()=>{N(l),c()},[l]);const F=async()=>{if(!i)return;const t=localStorage.getItem("token"),a=g(`Cập nhật tên ${i.hoTen} thành ${f}...`);try{const n=await fetch(`http://localhost:8080/taiKhoan/hoTen/${i.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({hoTen:f})});if(!n.ok){const o=await n.text();r(a,o);return}c(),h(null),u(a,"SUCCESSFULLY")}catch{r(a,"UNDEFINED ERROR")}},K=async()=>{if(!i)return;const t=localStorage.getItem("token"),a=g(`Đang xoá avt id:${i.id}, name:${i.hoTen} ...`);try{const n=await fetch(`http://localhost:8080/taiKhoan/setNullAvatar/${i.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`}});if(!n.ok){const o=await n.text();r(a,o);return}c(),h(null),u(a,"DELETED SUCCESSFULLY")}catch{r(a,"UNDEFINED ERROR")}},c=async()=>{let t;setTimeout(()=>{t=g("Đang tải thông tin người dùng...")},0);try{T("");const a=localStorage.getItem("token"),n=new URLSearchParams;n.append("page",l.toString()),p&&n.append("hoTen",p),x&&n.append("email",x),j&&n.append("sdt",j);const o=await fetch(`http://localhost:8080/taiKhoan/getAll?${n.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!o.ok){const Y=await o.text();r(t,Y);return}const d=await o.json();U(d.data||[]),H(d.totalPages||1),N(d.currentPage||1),P(d.totalItems||0),u(t,"SUCCESSFULLY!")}catch{T("Có lỗi xảy ra khi tải dữ liệu người dùng."),r(t,"UNDEFINED ERROR")}},B=async t=>{const a=g("Đang cập nhật...");try{const n=localStorage.getItem("token");await fetch(`http://localhost:8080/taiKhoan/thayDoiTrangThaiTaiKhoan/${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${n}`}}),await c(),u(a,"Cập nhật thành công!")}catch{r(a,"Cập nhật thất bại!"),T("Có lỗi xảy ra khi thay đổi trạng thái tài khoản.")}},O=async t=>{await q("Bạn có chắc muốn thực hiện hành động này?")&&await B(t)},I=()=>{v(1),c()},z=()=>{l>1&&v(t=>t-1)},M=()=>{v(t=>t+1)};return e.jsxs("div",{className:"user-mgmt-wrapper",children:[e.jsxs("h1",{children:["Quản lý người dùng (",k," hồ sơ)"]}),e.jsxs("span",{children:["“Trong biển lớn người dùng, hệ thống ta đang cất giữ ",e.jsx("b",{children:k})," bản ghi quý giá.”"]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),I()},className:"search-section",children:[e.jsxs("div",{className:"search-section",children:[e.jsx("input",{type:"text",placeholder:"Họ tên",name:"hoTen",value:p,onChange:t=>$(t.target.value)}),e.jsx("input",{type:"text",placeholder:"Email",name:"email",value:x,onChange:t=>A(t.target.value)}),e.jsx("input",{type:"text",placeholder:"Số điện thoại",name:"sdt",value:j,onChange:t=>R(t.target.value)}),e.jsx("button",{onClick:I,children:"Tìm kiếm"})]}),b&&e.jsx("div",{className:"error-msg",children:b})]}),e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Họ tên"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"SĐT"}),e.jsx("th",{children:"Avatar"}),e.jsx("th",{children:"Hành động"})]})}),e.jsx("tbody",{children:m&&m.length>0?m.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:t.hoTen}),e.jsx("td",{children:t.email}),e.jsx("td",{children:t.sdt}),e.jsx("td",{children:e.jsx("div",{className:"avatar-tooltip-wrapper",children:e.jsx("img",{src:t.anhDaiDien?`data:image/jpeg;base64,${t.anhDaiDien}`:"/images/def-avt.png",alt:"avatar",className:"user-avatar",onClick:()=>y(t.anhDaiDien?`data:image/jpeg;base64,${t.anhDaiDien}`:"/images/def-avt.png")})})}),e.jsxs("td",{children:[e.jsx("button",{className:"btn-sua",onClick:()=>L(t),children:"Sửa"}),e.jsx("button",{className:t.active?"btn-vo-hieu":"btn-kich-hoat",onClick:()=>O(t.id),children:t.active?"Vô hiệu hoá":"Kích hoạt"})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"no-data",children:"Không có dữ liệu"})})})]}),D&&e.jsx("div",{className:"overlay-usermgmt",onClick:()=>y(null),children:e.jsx("div",{className:"popup-image",onClick:t=>t.stopPropagation(),children:e.jsx("img",{src:D,alt:"avatar preview"})})}),i&&e.jsx("div",{className:"overlay-usermgmt",children:e.jsxs("div",{className:"popup-edit-user",ref:C,onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{children:"Sửa người dùng"}),e.jsx("label",{children:"Họ tên:"}),e.jsx("input",{type:"text",value:f,onChange:t=>w(t.target.value)}),e.jsx("button",{onClick:F,children:"Lưu họ tên"}),e.jsxs("div",{className:"avatar-edit-section",children:[e.jsx("img",{src:i.anhDaiDien?`data:image/jpeg;base64,${i.anhDaiDien}`:"/images/def-avt.png",alt:"avatar",className:"user-avatar"}),e.jsx("button",{onClick:K,children:"Xoá Avatar"})]})]})}),e.jsxs("div",{className:"pagination-user",children:[e.jsx("button",{onClick:z,disabled:S===1,children:"Trang trước"}),e.jsxs("span",{children:["Trang ",S," / ",E]}),e.jsx("button",{onClick:M,disabled:S>=E,children:"Trang sau"})]})]})};export{X as default};
