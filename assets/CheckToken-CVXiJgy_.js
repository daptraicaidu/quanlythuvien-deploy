import{r as l}from"./index-Cm4EQLYg.js";class i extends Error{}i.prototype.name="InvalidTokenError";function s(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,o)=>{let n=o.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function d(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return s(e)}catch{return atob(e)}}function p(t,e){if(typeof t!="string")throw new i("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,n=t.split(".")[o];if(typeof n!="string")throw new i(`Invalid token specified: missing part #${o+1}`);let a;try{a=d(n)}catch(r){throw new i(`Invalid token specified: invalid base64 for part #${o+1} (${r.message})`)}try{return JSON.parse(a)}catch(r){throw new i(`Invalid token specified: invalid json for part #${o+1} (${r.message})`)}}const h=()=>{const[t,e]=l.useState(null),[o,n]=l.useState(!0);return l.useEffect(()=>{const a=localStorage.getItem("token");if(a)try{const r=p(a),c=Date.now()/1e3;r.exp>c?e(r.vaiTro):(localStorage.removeItem("token"),localStorage.removeItem("vaiTro"),window.location.pathname!=="/quanlythuvien-deploy"&&(window.location.href="/quanlythuvien-deploy"))}catch(r){console.error("Token không hợp lệ:",r),localStorage.removeItem("token"),localStorage.removeItem("vaiTro"),window.location.pathname!=="/quanlythuvien-deploy"&&(window.location.href="/quanlythuvien-deploy")}else window.location.pathname!=="/quanlythuvien-deploy"&&(window.location.href="/quanlythuvien-deploy");n(!1)},[]),{role:t,loading:o}};export{h as u};
