import{r as c,j as e,g as L}from"./index-Dlb-Vogc.js";import{u as O}from"./CheckToken-DAtEsMNd.js";import{s as S,a as w,u as x}from"./toastUpdating-eMtTc5eb.js";import{c as I}from"./createLucideIcon-CvUPftRB.js";/**
 * @license lucide-react v0.537.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],$=I("trash-2",D),V=()=>{O();const[d,u]=c.useState(""),[C,g]=c.useState(""),[b,j]=c.useState(""),[k,a]=c.useState(""),[m,p]=c.useState([]),[f,r]=c.useState([]),[T,h]=c.useState({tongTien:0,tienCoc:0,tongTienMuon:0}),v=new Date().toLocaleDateString(),N=async()=>{const t={idSachCaBiet:Number(d),soNgayMuon:Number(C)},s=S(`ƒêang th√™m s√°ch m√£ ${d}...`);try{const i=await fetch("http://localhost:8080/ChiTietPhieuMuon/preview",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sachCaBiets:[...m,t]})});if(!i.ok){const o=i.headers.get("content-type");if(o!=null&&o.includes("application/json")){const l=await i.json();a(l.message||JSON.stringify(l))}else{const l=await i.text();a(l),w(s,l)}return}const n=await i.json(),y=n.chiTietPhieuMuons.map(o=>({id:o.idSachCaBiet,code:o.idSachCaBiet.toString(),name:o.tenSach,days:o.soNgayMuon,price:o.tienMuon,value:o.giaTriSach}));p(o=>[...o,t]),r(y),h({tongTien:n.tongTien,tienCoc:n.tienCoc,tongTienMuon:n.tongTienMuon}),u(""),g(""),a(""),x(s,`Th√™m s√°ch m√£ ${d} th√†nh c√¥ng!`)}catch(i){console.error("L·ªói khi g·ªçi preview:",i),w(s,"Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c ƒë·∫øn m√°y ch·ªß.")}},M=t=>{const s=m.filter(n=>n.idSachCaBiet!==t);p(s);const i=S(`ƒêang xo√° m√£ s√°ch ${t} kh·ªèi danh s√°ch m∆∞·ª£n...`);if(s.length===0){r([]),h({tongTien:0,tienCoc:0,tongTienMuon:0}),x(i,`ƒê√£ xo√° m√£ s√°ch ${t} (danh s√°ch m∆∞·ª£n tr·ªëng)`);return}fetch("http://localhost:8080/ChiTietPhieuMuon/preview",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sachCaBiets:s})}).then(n=>n.json()).then(n=>{const y=n.chiTietPhieuMuons.map(o=>({id:o.idSachCaBiet,code:o.idSachCaBiet.toString(),name:o.tenSach,days:o.soNgayMuon,price:o.tienMuon,value:o.giaTriSach}));r(y),h({tongTien:n.tongTien,tienCoc:n.tienCoc,tongTienMuon:n.tongTienMuon}),x(i,`ƒê√£ xo√° m√£ s√°ch ${t} kh·ªèi danh s√°ch m∆∞·ª£n!`)})},B=()=>{r([]),p([]),j(""),u(""),g(""),a(""),h({tongTien:0,tienCoc:0,tongTienMuon:0})},P=async()=>{await L("Reset phi·∫øu m∆∞·ª£n? M·ªçi d·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã xo√°.")&&B()};return e.jsxs("div",{className:"borrow-container",children:[e.jsx("h2",{children:"üìö Th√™m phi·∫øu m∆∞·ª£n"}),e.jsxs("div",{className:"popup-form",children:[e.jsxs("div",{className:"left-section",children:[e.jsxs("div",{className:"borrow-form",children:[e.jsx("input",{type:"text",placeholder:"Nh·∫≠p m√£ s√°ch c√° bi·ªát",value:d,onChange:t=>u(t.target.value)}),e.jsx("input",{type:"text",placeholder:"S·ªë ng√†y m∆∞·ª£n",value:C,onChange:t=>g(t.target.value)}),e.jsx("button",{className:"btn-yellow",onClick:N,children:"Th√™m s√°ch"})]}),e.jsx("div",{className:"borrow-create-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"STT"}),e.jsx("th",{children:"M√£ S√°ch CB"}),e.jsx("th",{children:"T√™n s√°ch"}),e.jsx("th",{children:"S·ªë ng√†y m∆∞·ª£n"}),e.jsx("th",{children:"Ph√≠ m∆∞·ª£n"}),e.jsx("th",{children:"Gi√° tr·ªã s√°ch"}),e.jsx("th",{children:"Xo√°"})]})}),e.jsx("tbody",{children:f.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:t.code}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.days}),e.jsxs("td",{children:[t.price*1e3,"ƒë"]}),e.jsxs("td",{children:[t.value*1e3,"ƒë"]}),e.jsx("td",{children:e.jsx($,{className:"delete-icon",onClick:()=>M(t.id)})})]},t.id))})]})})]}),e.jsxs("div",{className:"right-section",children:[e.jsx("label",{style:{width:"90px",fontWeight:"bold"},children:"ƒê∆°n h√†ng"}),e.jsx("hr",{}),e.jsxs("div",{className:"info-row",children:[e.jsx("label",{children:"Ng√†y l·∫≠p:"}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("label",{children:"SƒêT:"}),e.jsx("input",{type:"text",value:b,onChange:t=>j(t.target.value)})]}),e.jsx("button",{className:"btn-yellow",onClick:P,children:"ƒê∆°n h√†ng m·ªõi"}),k&&e.jsx("div",{className:"error-bookmgmt",children:k}),e.jsxs("div",{className:"bottom-section",children:[e.jsx("label",{style:{width:"90px",fontWeight:"bold"},children:"Thanh to√°n"}),e.jsx("hr",{}),e.jsxs("div",{className:"info-row total",children:[e.jsx("label",{children:"T·ªïng c·ªçc:"}),e.jsxs("span",{children:[(T.tienCoc*1e3).toLocaleString(),"ƒë"]})]}),e.jsxs("div",{className:"info-row total",children:[e.jsx("label",{children:"Ph√≠ m∆∞·ª£n:"}),e.jsxs("span",{children:[(T.tongTienMuon*1e3).toLocaleString(),"ƒë"]})]}),e.jsxs("div",{className:"info-row total",children:[e.jsx("label",{children:"T·ªïng ti·ªÅn:"}),e.jsxs("span",{children:[(T.tongTien*1e3).toLocaleString(),"ƒë"]})]})]}),e.jsx("button",{className:"btn-yellow",onClick:async()=>{const t=S("ƒêang t·∫°o phi·∫øu m∆∞·ª£n...");try{const s=await fetch("http://localhost:8080/phieuMuon/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sdt:b,sachCaBietRequest:{sachCaBiets:m}})}),i=s.headers.get("content-type");if(!s.ok){if(i!=null&&i.includes("application/json")){const n=await s.json();a(n.message||JSON.stringify(n))}else{const n=await s.text();a(n),w(t,n)}return}if(i!=null&&i.includes("application/json"))await s.json();else{const n=await s.text();x(t,"T·∫°o phi·∫øu m∆∞·ª£n th√†nh c√¥ng!"),console.log("Ph·∫£n h·ªìi kh√¥ng ph·∫£i JSON:",n)}r([]),p([]),j(""),u(""),g(""),a(""),h({tongTien:0,tienCoc:0,tongTienMuon:0})}catch(s){console.error("L·ªói khi t·∫°o phi·∫øu m∆∞·ª£n:",s),a("L·ªói kh√¥ng x√°c ƒë·ªãnh khi g·ªçi API.")}},children:"T·∫°o phi·∫øu m∆∞·ª£n"})]})]})]})};export{V as default};
