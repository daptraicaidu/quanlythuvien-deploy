import{a as W,b as X,r,j as a,c as _,f as J,d as Q}from"./index-CRlUMUKW.js";import{u as Y}from"./CheckToken-DQMO184W.js";import{s as g,u as x,a as h}from"./toastUpdating-DHhL3DLh.js";const p="http://localhost:8080/taiKhoan",d=W.create();d.interceptors.request.use(i=>{const n=localStorage.getItem("token");return n&&(i.headers.Authorization=`Bearer ${n}`),i});const f=async()=>await d.get(`${p}`),Z=async i=>await d.patch(`${p}/hoTen`,{hoTen:i}),aa=async i=>await d.patch(`${p}/email`,{email:i}),ea=async i=>await d.patch(`${p}/sdt`,{sdt:i}),ta=async i=>await d.patch(`${p}/matKhau`,i),$=async i=>await d.patch(`${p}/avatar`,i,{headers:{"Content-Type":"multipart/form-data"}}),ra=()=>{const{loading:i}=Y(),{userInfo:n,setUserInfo:j}=X(),[u,v]=r.useState(!1),[c,w]=r.useState({hoTen:"",email:"",sdt:""}),[l,T]=r.useState({old:"",new:"",confirm:""}),[y,L]=r.useState(!1),[E,b]=r.useState(null),[R,N]=r.useState(null),[F,k]=r.useState(null),[I,m]=r.useState(""),[A,C]=r.useState(""),[P,M]=r.useState(""),[U,S]=r.useState(!1),K=()=>L(!y);r.useEffect(()=>{B()},[]);const B=async()=>{let e;setTimeout(()=>{e=g("Đang tải thông tin tài khoản...")},0);try{const t=await f();j(t.data),w({hoTen:t.data.hoTen,email:t.data.email,sdt:t.data.sdt}),x(e,"Loaded Successfully!")}catch{h(e,"UNDEFINED ERROR")}},D=async e=>{var s;if(!n.hoTen||!n.email||!n.sdt){m("Không được để trống");return}if(e==="hoTen"&&c.hoTen===n.hoTen||e==="email"&&c.email===n.email||e==="sdt"&&c.sdt===n.sdt)return;const t=g("Đang cập nhật...");try{e==="hoTen"&&await Z(c.hoTen),e==="email"&&await aa(c.email),e==="sdt"&&await ea(c.sdt);const o=await f();j(o.data),v(!1),m(""),x(t,"Cập nhật thành công!")}catch(o){m(((s=o.response)==null?void 0:s.data)||"Lỗi update"),h(t,"Cập nhật thất bại!")}},H=async()=>{var t;if(!l.old&&!l.new&&!l.confirm){C("Nhập đầy đủ các trường");return}const e=g("Đang đổi mật khẩu...");try{await ta({matKhauCu:l.old,matKhauMoi:l.new,nhapLaiMatKhau:l.confirm}),x(e,"Đổi mật khẩu thành công!"),T({old:"",new:"",confirm:""}),C("")}catch(s){s.response?(C(((t=s.response)==null?void 0:t.data)||"Lỗi đổi mật khẩu"),h(e,s.response.data||"Có lỗi xảy ra từ server")):s.request?h(e,"Không nhận được phản hồi từ máy chủ."):h(e,"Lỗi không xác định khi gửi request.")}},q=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];k(t);const s=new FileReader;s.onloadend=()=>{N(s.result)},s.readAsDataURL(t);const o=t.size/1024,V=o>1024?`${(o/1024).toFixed(2)} MB`:`${o.toFixed(2)} KB`;M(`${t.name} (${V})`)}},z=async()=>{if(!F)return;const e=new FormData;e.append("anhDaiDien",F);const t=g("Đang cập nhật avatar...");try{await $(e);const s=await f();j(s.data),N(null),k(null),m(""),M(""),v(!1),x(t,"Cập nhật avatar thành công!")}catch{h(t,"Lỗi đổi avatar"),m("Lỗi đổi avatar  ")}},G=async()=>{const e=new FormData;e.append("anhDaiDien","");const t=g("Đang xoá avatar...");try{await $(e);const s=await f();j(s.data),N(null),k(null),m(""),v(!1),x(t,"Deleted Successfully!")}catch{h(t,"UNDEFINED ERROR")}};if(i||!n)return a.jsx("p",{children:"Đang tải dữ liệu ..."});const O=R||(n.anhDaiDien?`data:image/jpeg;base64,${n.anhDaiDien}`:"/images/def-avt.png");return a.jsxs("div",{className:"myaccount-wrapper",children:[a.jsxs("div",{className:"myaccount-container",children:[a.jsxs("div",{className:"left-section card",children:[a.jsxs("div",{className:"profile-info",children:[a.jsx("img",{src:O,alt:"avatar",className:"avatar",onClick:()=>b(n.anhDaiDien?`data:image/jpeg;base64,${n.anhDaiDien}`:"/images/def-avt.png")}),E&&a.jsx("div",{className:"overlay-usermgmt",onClick:()=>b(null),children:a.jsx("div",{className:"popup-image",onClick:e=>e.stopPropagation(),children:a.jsx("img",{src:E,alt:"avatar preview"})})}),a.jsxs("div",{className:"info-text",children:[a.jsx("h3",{children:"Đổi thông tin cá nhân"}),a.jsxs("div",{className:"edit-row",children:[a.jsx("label",{children:"Họ tên:"}),u?a.jsxs(a.Fragment,{children:[a.jsx("input",{value:c.hoTen,onChange:e=>w(t=>({...t,hoTen:e.target.value}))}),a.jsx("button",{onClick:()=>D("hoTen"),children:"Sửa"})]}):a.jsx("span",{children:n.hoTen})]}),a.jsxs("div",{className:"edit-row",children:[a.jsx("label",{children:"Email:"}),u?a.jsxs(a.Fragment,{children:[a.jsx("input",{value:c.email,onChange:e=>w(t=>({...t,email:e.target.value}))}),a.jsx("button",{onClick:()=>D("email"),children:"Sửa"})]}):a.jsx("span",{children:n.email})]}),a.jsxs("div",{className:"edit-row",children:[a.jsx("label",{children:"Số điện thoại:"}),u?a.jsxs(a.Fragment,{children:[a.jsx("input",{value:c.sdt,onChange:e=>w(t=>({...t,sdt:e.target.value}))}),a.jsx("button",{onClick:()=>D("sdt"),children:"Sửa"})]}):a.jsx("span",{children:n.sdt})]})]})]}),u&&a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"file",id:"avatar-upload",onChange:q,hidden:!0}),a.jsx("label",{htmlFor:"avatar-upload",className:"upload-btn",children:"Chọn ảnh đại diện"}),P&&a.jsx("div",{className:"file-info",children:P}),a.jsxs("div",{className:"avatar-actions",children:[a.jsx("button",{onClick:z,children:"Lưu ảnh đại diện mới"}),a.jsx("button",{onClick:G,children:"Xoá ảnh đại diện"})]})]}),a.jsx("button",{className:"showEdit-btn",onClick:()=>v(!u),children:u?"Ẩn chỉnh sửa":"Chỉnh sửa"}),I&&a.jsxs("div",{className:"error-text",children:[I,a.jsx("span",{className:"error-guide",onClick:()=>S(!0),children:"Hướng dẫn"})]})]}),a.jsxs("div",{className:"right-section",children:[a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Đổi mật khẩu"}),["old","new","confirm"].map((e,t)=>a.jsxs("div",{className:"password-input",children:[a.jsx("input",{type:y?"text":"password",placeholder:e==="old"?"Mật khẩu cũ":e==="new"?"Mật khẩu mới":"Nhập lại mật khẩu",value:l[e],onChange:s=>T(o=>({...o,[e]:s.target.value})),style:{maxWidth:"300px"}}),a.jsx("span",{onClick:K,className:"eye",children:a.jsx(_,{icon:y?J:Q})})]},t)),a.jsx("button",{className:"changePass-btn",onClick:H,children:"Đổi mật khẩu"})]}),A&&a.jsx("div",{className:"error-text",children:A})]})]}),U&&a.jsx("div",{className:"overlay-myaccount",onClick:()=>S(!1),children:a.jsxs("div",{className:"guide-modal",onClick:e=>e.stopPropagation(),children:[a.jsx("h2",{children:"Hướng dẫn up ảnh"}),a.jsx("p",{children:"Ảnh nên có kích thước nhỏ hơn 1MB. Định dạng nên là .jpg hoặc .png"}),a.jsx("p",{children:"Nếu ảnh lớn hơn 1MB thì gửi ảnh qua ứng dụng nhắn tin Messenger và lưu lại ảnh đó"}),a.jsx("h2",{children:"Hướng dẫn điền email"}),a.jsx("p",{children:"Email nên có định dạng : abc@example.com"}),a.jsx("button",{onClick:()=>S(!1),children:"Đóng"})]})})]})};export{ra as default};
