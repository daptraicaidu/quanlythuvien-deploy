import{r as c,j as e,g as L}from"./index-Cm4EQLYg.js";import{u as O}from"./CheckToken-CVXiJgy_.js";import{s as S,a as b,u as x}from"./toastUpdating-DHdby-RR.js";import{c as I}from"./createLucideIcon-DnzXhOGU.js";/**
 * @license lucide-react v0.537.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],$=I("trash-2",D),R=()=>{O();const[d,g]=c.useState(""),[w,u]=c.useState(""),[v,m]=c.useState(""),[C,a]=c.useState(""),[j,p]=c.useState([]),[k,r]=c.useState([]),[T,h]=c.useState({tongTien:0,tienCoc:0,tongTienMuon:0}),f=new Date().toLocaleDateString(),N=async()=>{const n={idSachCaBiet:Number(d),soNgayMuon:Number(w)},s=S(`ƒêang th√™m s√°ch m√£ ${d}...`);try{const i=await fetch("https://qltv-be-r6rg.onrender.com/ChiTietPhieuMuon/preview",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sachCaBiets:[...j,n]})});if(!i.ok){const o=i.headers.get("content-type");if(o!=null&&o.includes("application/json")){const l=await i.json();a(l.message||JSON.stringify(l))}else{const l=await i.text();a(l),b(s,l)}return}const t=await i.json(),y=t.chiTietPhieuMuons.map(o=>({id:o.idSachCaBiet,code:o.idSachCaBiet.toString(),name:o.tenSach,days:o.soNgayMuon,price:o.tienMuon,value:o.giaTriSach}));p(o=>[...o,n]),r(y),h({tongTien:t.tongTien,tienCoc:t.tienCoc,tongTienMuon:t.tongTienMuon}),g(""),u(""),a(""),x(s,`Th√™m s√°ch m√£ ${d} th√†nh c√¥ng!`)}catch(i){console.error("L·ªói khi g·ªçi preview:",i),b(s,"Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c ƒë·∫øn m√°y ch·ªß.")}},M=n=>{const s=j.filter(t=>t.idSachCaBiet!==n);p(s);const i=S(`ƒêang xo√° m√£ s√°ch ${n} kh·ªèi danh s√°ch m∆∞·ª£n...`);if(s.length===0){r([]),h({tongTien:0,tienCoc:0,tongTienMuon:0}),x(i,`ƒê√£ xo√° m√£ s√°ch ${n} (danh s√°ch m∆∞·ª£n tr·ªëng)`);return}fetch("https://qltv-be-r6rg.onrender.com/ChiTietPhieuMuon/preview",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sachCaBiets:s})}).then(t=>t.json()).then(t=>{const y=t.chiTietPhieuMuons.map(o=>({id:o.idSachCaBiet,code:o.idSachCaBiet.toString(),name:o.tenSach,days:o.soNgayMuon,price:o.tienMuon,value:o.giaTriSach}));r(y),h({tongTien:t.tongTien,tienCoc:t.tienCoc,tongTienMuon:t.tongTienMuon}),x(i,`ƒê√£ xo√° m√£ s√°ch ${n} kh·ªèi danh s√°ch m∆∞·ª£n!`)})},B=()=>{r([]),p([]),m(""),g(""),u(""),a(""),h({tongTien:0,tienCoc:0,tongTienMuon:0})},P=async()=>{await L("Reset phi·∫øu m∆∞·ª£n? M·ªçi d·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã xo√°.")&&B()};return e.jsxs("div",{className:"borrow-container",children:[e.jsx("h2",{children:"üìö Th√™m phi·∫øu m∆∞·ª£n"}),e.jsxs("div",{className:"popup-form",children:[e.jsxs("div",{className:"left-section",children:[e.jsxs("div",{className:"borrow-form",children:[e.jsx("input",{type:"text",placeholder:"Nh·∫≠p m√£ s√°ch c√° bi·ªát",value:d,onChange:n=>g(n.target.value)}),e.jsx("input",{type:"text",placeholder:"S·ªë ng√†y m∆∞·ª£n",value:w,onChange:n=>u(n.target.value)}),e.jsx("button",{className:"btn-yellow",onClick:N,children:"Th√™m s√°ch"})]}),e.jsx("div",{className:"borrow-create-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"STT"}),e.jsx("th",{children:"M√£ S√°ch CB"}),e.jsx("th",{children:"T√™n s√°ch"}),e.jsx("th",{children:"S·ªë ng√†y m∆∞·ª£n"}),e.jsx("th",{children:"Ph√≠ m∆∞·ª£n"}),e.jsx("th",{children:"Gi√° tr·ªã s√°ch"}),e.jsx("th",{children:"Xo√°"})]})}),e.jsx("tbody",{children:k.map((n,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:n.code}),e.jsx("td",{children:n.name}),e.jsx("td",{children:n.days}),e.jsxs("td",{children:[n.price*1e3,"ƒë"]}),e.jsxs("td",{children:[n.value*1e3,"ƒë"]}),e.jsx("td",{children:e.jsx($,{className:"delete-icon",onClick:()=>M(n.id)})})]},n.id))})]})})]}),e.jsxs("div",{className:"right-section",children:[e.jsx("label",{style:{width:"90px",fontWeight:"bold"},children:"ƒê∆°n h√†ng"}),e.jsx("hr",{}),e.jsxs("div",{className:"info-row",children:[e.jsx("label",{children:"Ng√†y l·∫≠p:"}),e.jsx("span",{children:f})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("label",{children:"SƒêT:"}),e.jsx("input",{type:"text",value:v,onChange:n=>m(n.target.value)})]}),e.jsx("button",{className:"btn-yellow",onClick:P,children:"ƒê∆°n h√†ng m·ªõi"}),C&&e.jsx("div",{className:"error-bookmgmt",children:C}),e.jsxs("div",{className:"bottom-section",children:[e.jsx("label",{style:{width:"90px",fontWeight:"bold"},children:"Thanh to√°n"}),e.jsx("hr",{}),e.jsxs("div",{className:"info-row total",children:[e.jsx("label",{children:"T·ªïng c·ªçc:"}),e.jsxs("span",{children:[(T.tienCoc*1e3).toLocaleString(),"ƒë"]})]}),e.jsxs("div",{className:"info-row total",children:[e.jsx("label",{children:"Ph√≠ m∆∞·ª£n:"}),e.jsxs("span",{children:[(T.tongTienMuon*1e3).toLocaleString(),"ƒë"]})]}),e.jsxs("div",{className:"info-row total",children:[e.jsx("label",{children:"T·ªïng ti·ªÅn:"}),e.jsxs("span",{children:[(T.tongTien*1e3).toLocaleString(),"ƒë"]})]})]}),e.jsx("button",{className:"btn-yellow",onClick:async()=>{const n=S("ƒêang t·∫°o phi·∫øu m∆∞·ª£n...");try{const s=await fetch("https://qltv-be-r6rg.onrender.com/phieuMuon/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sdt:v,sachCaBietRequest:{sachCaBiets:j}})}),i=s.headers.get("content-type");if(!s.ok){if(i!=null&&i.includes("application/json")){const t=await s.json();a(t.message||JSON.stringify(t))}else{const t=await s.text();a(t),b(n,t)}return}if(i!=null&&i.includes("application/json"))await s.json();else{const t=await s.text();x(n,"T·∫°o phi·∫øu m∆∞·ª£n th√†nh c√¥ng!"),console.log("Ph·∫£n h·ªìi kh√¥ng ph·∫£i JSON:",t)}r([]),p([]),m(""),g(""),u(""),a(""),h({tongTien:0,tienCoc:0,tongTienMuon:0})}catch(s){console.error("L·ªói khi t·∫°o phi·∫øu m∆∞·ª£n:",s),a("L·ªói kh√¥ng x√°c ƒë·ªãnh khi g·ªçi API.")}},children:"T·∫°o phi·∫øu m∆∞·ª£n"})]})]})]})};export{R as default};
