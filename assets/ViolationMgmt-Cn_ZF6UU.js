import{r as n,j as t,a as N,g as U}from"./index-DTfLEByv.js";import{s as x,u as j,a as m}from"./toastUpdating-4Z3rWBdx.js";const z=()=>{const[v,f]=n.useState([]),[w,I]=n.useState(!0),[b,P]=n.useState(null),[S,L]=n.useState(1),[d,T]=n.useState(1),[E,V]=n.useState(0);console.log(E);const[r,u]=n.useState(1),[g,R]=n.useState(""),[p,X]=n.useState(""),[y,k]=n.useState(null),[h,i]=n.useState({moTa:"",hinhThucXuLy:"",tienPhat:0}),B=e=>{k(e.idViPham),i({moTa:e.moTa,hinhThucXuLy:e.hinhThucXuLy,tienPhat:e.tienPhat})},C=()=>{k(null),i({moTa:"",hinhThucXuLy:"",tienPhat:0})},D=async e=>{const s=x("Đang cập nhật vi phạm..."),a=localStorage.getItem("token");try{await N.put("http://localhost:8080/viPham/edit",{id:e,...h},{headers:{Authorization:`Bearer ${a}`}}),j(s,"Cập nhật thành công!"),C(),l()}catch(c){console.error("Lỗi cập nhật vi phạm:",c),m(s,"Cập nhật thất bại!")}},l=async()=>{let e;setTimeout(()=>{e=x("Đang tải danh sách vi phạm...")},0);const s=localStorage.getItem("token");try{const a=new URLSearchParams;a.append("page",r.toString()),g&&a.append("idPhieuMuon",g),p&&a.append("sdt",p);const o=await(await fetch(`http://localhost:8080/viPham/getAll?${a.toString()}`,{headers:{Authorization:`Bearer ${s}`}})).json();f(o.data||[]),L(o.totalPages||1),T(o.currentPage||1),V(o.totalItems||0),j(e,"LOADED SUCCESSFULLY!")}catch(a){console.error("Lỗi lấy dữ liệu vi phạm: ",a),m(e,"UNDEFINED ERROR")}finally{I(!1)}},$=async e=>{if(!await U("Chắc chắn muốn xoá vi phạm này?"))return;const a=x("Đang xoá vi phạm..."),c=localStorage.getItem("token");try{await N.delete(`http://localhost:8080/viPham/delete/${e}`,{headers:{Authorization:`Bearer ${c}`}}),j(a,"Xoá thành công!"),l()}catch(o){console.error("Lỗi xoá vi phạm:",o),m(a,"Xoá thất bại!")}},F=()=>{u(1),l()};n.useEffect(()=>{T(r),l()},[r]);const A=()=>{r>1&&u(e=>e-1)},M=()=>{u(e=>e+1)};return t.jsxs("div",{className:"violation-container2",children:[t.jsx("h2",{className:"violation-title",children:"Quản lý vi phạm"}),t.jsxs("div",{className:"search-bar",children:[t.jsx("input",{type:"text",placeholder:"Nhập ID phiếu mượn",value:g,onChange:e=>R(e.target.value)}),t.jsx("input",{type:"text",placeholder:"Nhập số điện thoại",value:p,onChange:e=>X(e.target.value)}),t.jsx("button",{onClick:F,children:"Tìm kiếm"})]}),w?t.jsx("p",{className:"violation-loading",children:"Đang tải dữ liệu..."}):v.length===0?t.jsx("p",{className:"violation-empty",children:"Bạn chưa có vi phạm nào."}):t.jsxs("table",{className:"violation-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Mã sách CB"}),t.jsx("th",{children:"Ảnh bìa"}),t.jsx("th",{children:"Họ tên"}),t.jsx("th",{children:"SĐT"}),t.jsx("th",{children:"Tên sách"}),t.jsx("th",{children:"Mô tả"}),t.jsx("th",{children:"Hình thức xử lý"}),t.jsx("th",{children:"Tiền phạt"}),t.jsx("th",{children:"Ngày vi phạm"}),t.jsx("th",{children:"Hành động"})]})}),t.jsx("tbody",{children:v.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.idSachCaBiet}),t.jsx("td",{className:"bookcover-cell",children:t.jsx("div",{className:"bookcover-tooltip-wrapper",children:t.jsx("img",{src:`data:image/jpeg;base64,${e.anhBia}`,alt:"Ảnh bìa",className:"violation-img",onClick:()=>P(e.anhBia?`data:image/jpeg;base64,${e.anhBia}`:"/images/def-cover.png")})})}),t.jsx("td",{children:e.hoten}),t.jsx("td",{children:e.sdt}),t.jsx("td",{children:e.tenSach}),y===e.idViPham?t.jsxs(t.Fragment,{children:[t.jsx("td",{children:t.jsx("textarea",{style:{backgroundColor:"rgb(255, 246, 230)",color:"orange",border:"1px solid orange",padding:"4px 8px",borderRadius:4,fontWeight:"bold",width:"100%"},value:h.moTa,onChange:s=>i(a=>({...a,moTa:s.target.value}))})}),t.jsx("td",{children:t.jsx("input",{style:{backgroundColor:"rgb(255, 246, 230)",color:"orange",border:"1px solid orange",padding:"4px 8px",borderRadius:4,fontWeight:"bold",width:"100%"},type:"text",value:h.hinhThucXuLy,onChange:s=>i(a=>({...a,hinhThucXuLy:s.target.value}))})}),t.jsx("td",{children:t.jsx("input",{style:{backgroundColor:"rgb(255, 246, 230)",color:"orange",border:"1px solid orange",padding:"4px 8px",borderRadius:4,fontWeight:"bold",width:"100%"},type:"number",min:0,value:h.tienPhat,onChange:s=>i(a=>({...a,tienPhat:parseInt(s.target.value)||0}))})})]}):t.jsxs(t.Fragment,{children:[t.jsx("td",{children:e.moTa}),t.jsx("td",{children:e.hinhThucXuLy}),t.jsxs("td",{children:[(e.tienPhat*1e3).toLocaleString("vi-VN"),"đ"]})]}),t.jsx("td",{children:e.ngayViPham}),t.jsx("td",{children:y===e.idViPham?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"edit-btn",onClick:()=>D(e.idViPham),children:"Lưu"}),t.jsx("button",{className:"delete-btn",onClick:C,children:"Huỷ"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"edit-btn",onClick:()=>B(e),children:"Sửa"}),t.jsx("button",{className:"delete-btn",onClick:()=>$(e.idViPham),children:"Xoá"})]})})]},e.idViPham))})]}),t.jsxs("div",{className:"pagination-user",children:[t.jsx("button",{onClick:A,disabled:d===1,children:"Trang trước"}),t.jsxs("span",{children:["Trang ",d," / ",S]}),t.jsx("button",{onClick:M,disabled:d>=S,children:"Trang sau"})]}),b&&t.jsx("div",{className:"overlay-bookmgmt",onClick:()=>P(null),children:t.jsx("div",{className:"bookcover-preview",onClick:e=>e.stopPropagation(),children:t.jsx("img",{src:b,alt:"book preview"})})})]})};export{z as default};
