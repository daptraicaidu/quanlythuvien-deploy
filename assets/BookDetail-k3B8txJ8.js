import{m as E,r,j as e,g as R}from"./index-Cm4EQLYg.js";import{s as y,u as w,a as h}from"./toastUpdating-DHdby-RR.js";const q=()=>{const{id:o}=E(),[n,g]=r.useState(null),[l,m]=r.useState(0),[D,x]=r.useState(0),[u,p]=r.useState(""),[j,v]=r.useState(!1),[b,S]=r.useState(""),[f,T]=r.useState(0),d=250,C=t=>{const[i,a,s]=t.split("-");if(!s)return"Ngày không hợp lệ";const[c,B]=s.split(" "),L=`${c}-${a}-${i}T${B}`,k=new Date(L);return`${k.toLocaleDateString()} ${k.toLocaleTimeString()}`},G=async()=>{if(l===0){S("Vui lòng chọn số sao!");return}v(!0),S("");const t=y("Đang gửi đánh giá...");try{const i=localStorage.getItem("token"),a=await fetch("https://qltv-be-r6rg.onrender.com/DanhGia/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({idSach:Number(o),diemDanhGia:l,noiDung:u})});if(a.ok){p(""),m(0),o&&N(o,g),w(t,"Gửi đánh giá thành công!");return}else{const s=await a.text();h(t,s)}}catch{h(t,"Không kết nối được đến máy chủ")}v(!1)},$=async()=>{await R("Chắc chắn gửi bình luận này?(sau khi gửi sẽ không thể xoá)")&&await G()},N=async(t,i)=>{let a;setTimeout(()=>{a=y("Đang tải chi tiết sách...")},0);try{const s=await fetch(`https://qltv-be-r6rg.onrender.com/sach/getSach/${t}`);if(s.ok){const c=await s.json();i(c),w(a,"Tải chi tiết sách thành công!")}else{const c=await s.text();h(a,c)}}catch(s){console.error("Lỗi lấy chi tiết sách:",s),h(a,"Không kết nối được đến máy chủ")}};return r.useEffect(()=>{o&&N(o,g)},[o]),n?e.jsxs("div",{className:"book-detail-container",children:[e.jsxs("div",{className:"book-detail-card",children:[e.jsx("div",{className:"book-detail-left",children:e.jsx("img",{src:`data:image/jpeg;base64,${n.anhBia}`,alt:n.tenSach})}),e.jsxs("div",{className:"book-detail-right",children:[e.jsx("h2",{children:n.tenSach}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tác giả:"})," ",n.tacGia]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nhà xuất bản:"})," ",n.nhaXuatBan]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Năm xuất bản:"})," ",n.namXuatBan]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tiền mượn:"})," ",(n.tienMuon*1e3).toLocaleString("vi-VN"),"đ/ngày"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Sách sẵn sàng:"})," ",n.soSachSanSangChoMuon]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Thể loại:"})," ",n.theLoais.join(", ")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Điểm đánh giá:"})," ⭐ ",n.diemDanhGia.toFixed(1)," (",n.soLuotDanhGia," lượt)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Giới thiệu:"})," ",n.tomTat]})]})]}),e.jsxs("div",{className:"user-review-form",children:[e.jsx("h3",{children:"Viết đánh giá của bạn"}),e.jsx("div",{className:"star-rating",children:[1,2,3,4,5].map(t=>e.jsx("span",{className:`star ${t<=(D||l)?"filled":""}`,onClick:()=>m(t),onMouseEnter:()=>x(t),onMouseLeave:()=>x(0),children:"★"},t))}),e.jsxs("div",{style:{position:"relative",width:"100%"},children:[" ",e.jsx("textarea",{placeholder:"Nhập nội dung đánh giá...(tối đa 250 kí tự)",value:u,onChange:t=>{p(t.target.value),T(t.target.value.length)},maxLength:d,style:{width:"100%",height:"130px",padding:"10px",paddingBottom:"30px",resize:"none",fontSize:"1rem",borderRadius:"6px",border:"1px solid #ccc",boxSizing:"border-box"}}),e.jsxs("div",{style:{position:"absolute",right:"10px",bottom:"10px",fontSize:"0.8rem",color:f>=d?"red":"#666",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"0 4px",borderRadius:"3px",pointerEvents:"none"},children:[f,"/",d]})]}),e.jsx("button",{onClick:$,disabled:j,children:j?"Đang gửi...":"Gửi"}),b&&e.jsx("div",{className:"error-bookmgmt",children:b})]}),e.jsxs("div",{className:"book-review-section",children:[e.jsx("h3",{children:"Đánh giá từ độc giả"}),n.danhGias.length===0?e.jsx("p",{children:"Chưa có đánh giá nào."}):n.danhGias.map((t,i)=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("img",{src:t.anhDaiDien?`data:image/jpeg;base64,${t.anhDaiDien}`:"/quanlythuvien-deploy/images/def-avt.png",alt:"avatar",className:"review-avatar"}),e.jsxs("div",{className:"review-user-info",children:[e.jsx("p",{className:"review-name",children:t.hoten}),e.jsx("p",{className:"review-date",children:C(t.ngayDanhGia)})]})]}),e.jsxs("p",{className:"review-rating",children:["⭐ ",t.diemDanhGia,"/5"]}),e.jsx("p",{className:"review-content",children:t.noiDung})]},i))]})]}):e.jsx("div",{className:"loading",children:"Đang tải chi tiết sách..."})};export{q as default};
