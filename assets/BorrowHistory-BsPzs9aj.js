import{r as n,j as e,l as B}from"./index-Dlb-Vogc.js";import{s as E,u as M,a as $}from"./toastUpdating-eMtTc5eb.js";import{c as v}from"./createLucideIcon-CvUPftRB.js";/**
 * @license lucide-react v0.537.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],A=v("chevron-down",D);/**
 * @license lucide-react v0.537.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],_=v("chevron-right",V),H=()=>{const[r,T]=n.useState([]),[a,c]=n.useState([]),[x,g]=n.useState(null),[w,b]=n.useState(!0),[i,d]=n.useState([]),[j,y]=n.useState(1),[h,m]=n.useState(1),[S,f]=n.useState(0);console.log(S);const[o,u]=n.useState(1),k=async()=>{let s;setTimeout(()=>{s=E("Đang tải lịch sử mượn sách...")},0);try{const t=localStorage.getItem("token"),N=new URLSearchParams;N.append("page",o.toString());const l=await(await fetch(`http://localhost:8080/phieuMuon/lichSuMuon?${N.toString()}`,{headers:{Authorization:`Bearer ${t}`}})).json();T(l.data),y(l.totalPages||1),m(l.currentPage||1),f(l.totalItems||0),M(s,"Loaded successfully")}catch(t){console.error("Lỗi fetch lịch sử mượn:",t),$(s,"UNDEFINED ERROR.")}finally{b(!1)}};n.useEffect(()=>{const s=async()=>{await k(),c([]),d([])};m(o),s()},[o]);const C=()=>{o>1&&u(s=>s-1)},L=()=>{u(s=>s+1)},P=s=>{a.includes(s)?(d([...i,s]),setTimeout(()=>{c(a.filter(t=>t!==s)),d(i.filter(t=>t!==s))},250)):c([...a,s])},R=()=>{c(p?[]:r.map(s=>s.id))},p=a.length>0,I=p?"Thu gọn tất cả":"Mở tất cả";return e.jsxs("div",{className:"borrow-history-container",children:[e.jsxs("div",{className:"borrow-history-header",children:[e.jsx("h2",{className:"borrow-history-title",children:"📚 Lịch sử mượn sách"}),e.jsx("button",{className:"expand-all-button",onClick:R,children:I})]}),w?e.jsx("p",{className:"violation-loading",children:"Đang tải dữ liệu..."}):r.length===0?e.jsx("p",{className:"violation-empty",children:"Bạn chưa lịch sử mượn sách nào."}):e.jsxs("table",{className:"borrow-history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Ngày mượn"}),e.jsx("th",{children:"Tổng tiền mượn"}),e.jsx("th",{children:"Tiền cọc còn lại"})]})}),e.jsx("tbody",{children:r.map(s=>e.jsxs(B.Fragment,{children:[e.jsxs("tr",{className:`main-row ${a.includes(s.id)&&!i.includes(s.id)?"row-expanded":""}`,onClick:()=>P(s.id),children:[e.jsxs("td",{className:"id-cell",children:[e.jsx("span",{className:"expand-icon-wrapper",children:e.jsx("span",{className:`expand-icon ${a.includes(s.id)?"expanded":"wiggle"}`,children:a.includes(s.id)?e.jsx(A,{size:18}):e.jsx(_,{size:18})})}),s.id]}),e.jsx("td",{children:s.ngayMuon}),e.jsxs("td",{children:[(s.tongTienMuon*1e3).toLocaleString("vi-VN"),"đ"]}),e.jsxs("td",{children:[(s.tienCocConLai*1e3).toLocaleString("vi-VN"),"đ"]})]}),a.includes(s.id)&&e.jsx("tr",{className:`expand-container ${i.includes(s.id)?"closing":""}`,children:e.jsx("td",{colSpan:4,children:e.jsx("div",{className:"expand-animation",children:e.jsxs("table",{className:"nested-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Mã sách CB"}),e.jsx("th",{children:"Ảnh bìa"}),e.jsx("th",{children:"Tên sách"}),e.jsx("th",{children:"Ngày trả dự kiến"}),e.jsx("th",{children:"Ngày trả thực tế"}),e.jsx("th",{children:"Tiền mượn"}),e.jsx("th",{children:"Tiền cọc"}),e.jsx("th",{children:"Tiền phạt"})]})}),e.jsx("tbody",{children:s.chiTietPhieuMuons.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.idSachCaBiet}),e.jsx("td",{className:"bookcover-cell",children:e.jsx("div",{className:"bookcover-tooltip-wrapper",children:e.jsx("img",{src:`data:image/jpeg;base64,${t.anhBia}`,alt:"Ảnh bìa",className:"violation-img",onClick:()=>g(t.anhBia?`data:image/jpeg;base64,${t.anhBia}`:"/quanlythuvien-deploy/images/def-cover.png")})})}),e.jsx("td",{children:t.tenSach}),e.jsx("td",{children:t.ngayTra}),e.jsx("td",{children:t.ngayTraThucTe?t.ngayTraThucTe:"---"}),e.jsxs("td",{children:[(t.tienMuon*1e3).toLocaleString("vi-VN"),"đ"]}),e.jsxs("td",{children:[(t.tienCoc*1e3).toLocaleString("vi-VN"),"đ"]}),e.jsxs("td",{children:[(t.tienPhat*1e3).toLocaleString("vi-VN"),"đ"]})]},t.idSachCaBiet))})]})})})})]},s.id))})]}),e.jsxs("div",{className:"pagination-user",children:[e.jsx("button",{onClick:C,disabled:h===1,children:"Trang trước"}),e.jsxs("span",{children:["Trang ",h," / ",j]}),e.jsx("button",{onClick:L,disabled:h>=j,children:"Trang sau"})]}),x&&e.jsx("div",{className:"overlay-bookmgmt",onClick:()=>g(null),children:e.jsx("div",{className:"bookcover-preview",onClick:s=>s.stopPropagation(),children:e.jsx("img",{src:x,alt:"book preview"})})})]})};export{H as default};
