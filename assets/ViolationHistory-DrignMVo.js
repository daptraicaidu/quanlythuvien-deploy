import{r as a,j as e}from"./index-Cm4EQLYg.js";import{s as T,u as k,a as y}from"./toastUpdating-DHdby-RR.js";const I=()=>{const[c,j]=a.useState([]),[p,m]=a.useState(!0),[l,h]=a.useState(null),[d,u]=a.useState(1),[o,g]=a.useState(1),[v,S]=a.useState(0);console.log(v);const[s,x]=a.useState(1),P=async()=>{const t=localStorage.getItem("token");let r;setTimeout(()=>{r=T("Đang tải lịch sử vi phạm...")},0);try{const n=new URLSearchParams;n.append("page",s.toString());const i=await(await fetch(`https://qltv-be-r6rg.onrender.com/viPham/getViPhamForUser?${n.toString()}`,{headers:{Authorization:`Bearer ${t}`}})).json();j(i.data),u(i.totalPages||1),g(i.currentPage||1),S(i.totalItems||0),k(r,"SUCCESSFULLY!")}catch(n){y(r,"UNDEFINED ERROR!"),console.error("Lỗi khi gọi API vi phạm:",n)}finally{m(!1)}};a.useEffect(()=>{g(s),P()},[s]);const b=()=>{s>1&&x(t=>t-1)},N=()=>{x(t=>t+1)};return e.jsxs("div",{className:"violation-container",children:[e.jsx("h1",{className:"violation-title",children:"📚 Lịch Sử Vi Phạm"}),p?e.jsx("p",{className:"violation-loading",children:"Đang tải dữ liệu..."}):c.length===0?e.jsx("p",{className:"violation-empty",children:"Bạn chưa có vi phạm nào."}):e.jsxs("table",{className:"violation-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Mã sách CB"}),e.jsx("th",{children:"Ảnh bìa"}),e.jsx("th",{children:"Tên sách"}),e.jsx("th",{children:"Mô tả"}),e.jsx("th",{children:"Hình thức xử lý"}),e.jsx("th",{children:"Tiền phạt"}),e.jsx("th",{children:"Ngày vi phạm"})]})}),e.jsx("tbody",{children:c.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.idSachCaBiet}),e.jsx("td",{className:"bookcover-cell",children:e.jsx("div",{className:"bookcover-tooltip-wrapper",children:e.jsx("img",{src:`data:image/jpeg;base64,${t.anhBia}`,alt:"Ảnh bìa",className:"violation-img",onClick:()=>h(t.anhBia?`data:image/jpeg;base64,${t.anhBia}`:"/quanlythuvien-deploy/images/def-cover.png")})})}),e.jsx("td",{children:t.tenSach}),e.jsx("td",{children:t.moTa}),e.jsx("td",{children:t.hinhThucXuLy}),e.jsxs("td",{children:[(t.tienPhat*1e3).toLocaleString("vi-VN"),"đ"]}),e.jsx("td",{children:t.ngayViPham})]},t.idChiTietPhieuMuon))})]}),e.jsxs("div",{className:"pagination-user",children:[e.jsx("button",{onClick:b,disabled:o===1,children:"Trang trước"}),e.jsxs("span",{children:["Trang ",o," / ",d]}),e.jsx("button",{onClick:N,disabled:o>=d,children:"Trang sau"})]}),l&&e.jsx("div",{className:"overlay-bookmgmt",onClick:()=>h(null),children:e.jsx("div",{className:"bookcover-preview",onClick:t=>t.stopPropagation(),children:e.jsx("img",{src:l,alt:"book preview"})})})]})};export{I as default};
